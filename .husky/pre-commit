# Run file checks (size, type, secrets, whitespace)
echo "ğŸ” Running file checks..."
./scripts/pre-commit-checks.sh || exit 1

# Run lint-staged (formatting and linting)
echo "ğŸ¨ Running formatters and linters..."
npx lint-staged || exit 1

# Run fast unit tests (only if Go files changed)
if git diff --cached --name-only | grep -q '\.go$'; then
  echo "ğŸ§ª Running Go tests..."
  cd apps/api-go && go test ./... -short || exit 1
  cd ../..
fi

# Type check TypeScript (only if TS files changed)
if git diff --cached --name-only | grep -qE '\.(ts|tsx)$'; then
  echo "ğŸ”· Type checking TypeScript..."
  if git diff --cached --name-only | grep -q 'apps/edge-worker/.*\.ts$'; then
    cd apps/edge-worker && npm run typecheck || exit 1
    cd ../..
  fi
  # Builder type checking is handled by ESLint with TypeScript parser
fi
