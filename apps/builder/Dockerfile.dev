# Development Dockerfile with hot reloading support
# This image includes Node.js and npm for Vite development server
FROM node:20-alpine

WORKDIR /app

# Install build dependencies and wget for healthchecks
RUN apk add --no-cache git ca-certificates tzdata wget

# Copy package files for dependency caching
COPY apps/builder/package.json apps/builder/package-lock.json* apps/builder/pnpm-lock.yaml* ./

# Install dependencies
# Prefer pnpm if pnpm-lock.yaml exists, otherwise use npm with legacy-peer-deps
RUN if [ -f pnpm-lock.yaml ]; then \
      npm install -g pnpm && pnpm install; \
    elif [ -f package-lock.json ]; then \
      npm ci --legacy-peer-deps; \
    else \
      npm install --legacy-peer-deps; \
    fi

# Note: Source code is mounted as volume in docker-compose.yml, so we don't copy it here
# This allows hot reloading without rebuilding the image

# Expose Vite dev server port
EXPOSE 5173

# Default command runs Vite dev server
# Host binding is configured in vite.config.ts (host: '0.0.0.0')
CMD ["npm", "run", "dev"]

